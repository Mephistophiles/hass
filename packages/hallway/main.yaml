hallway:
  homeassistant:
    customize:
      light.hallway_light:
        friendly_name: Hallway Light
        icon: mdi:ceiling-light
      binary_sensor.0x54ef44100056353b_presence:
        friendly_name: Presence in hallway
        icon: mdi:motion-sensor
      switch.0xa4c1380e48732b0f:
        friendly_name: Fridge
        icon: mdi:fridge-variant
      binary_sensor.hallway_presence:
        friendly_name: Presence in Hallway
      switch.0xa4c138a7187b2e2c:
        friendly_name: Socket
        icon: mdi:power-socket-eu
      light.hallway_boardroom:
        friendly_name: Boardroom
      light.hallway_kitchen:
        friendly_name: Kitchen
      light.0xa4c13887918ab25b:
        friendly_name: Boardroom backlight
      binary_sensor.0xa4c138638ca68c94_occupancy:
        friendly_name: Presence in Boardroom

  light:
    - platform: switch
      name: Hallway Light
      entity_id: switch.sonoff_100064a4af

  template:
    - binary_sensor:
        - name: hallway_presence
          device_class: presence
          state: >
            {{ is_state('binary_sensor.0x54ef44100056353b_presence', 'on') or
              states('sensor.0x54ef44100056353b_presence_event') not in ['leave', 'unavailable', 'unknown']
            }}

  automation:
    - id: hallway_presence_detected
      alias: hallway_presence_detected
      description: Hallway - presence detecteed
      trigger:
        - platform: state
          entity_id: binary_sensor.hallway_presence
          to: "on"
      condition:
        - condition: state
          entity_id: light.hallway_light
          state: "off"
      action:
        - service: light.turn_on
          entity_id: light.hallway_light

    - id: hallway_presence_clear
      alias: hallway_presence_clear
      description: Hallway - presence not detected
      trigger:
        - platform: state
          entity_id: binary_sensor.hallway_presence
          to: "off"
          for:
            hours: 0
            minutes: 0
            seconds: 10
      action:
        - service: light.turn_off
          entity_id: light.hallway_light

    - id: backlight_auto_on
      alias: backlight_auto_on
      description: Backlight - enable by motion
      trigger:
        - platform: state
          entity_id: binary_sensor.0xa4c138638ca68c94_occupancy
          to: "on"
      condition:
        - condition: state
          entity_id: input_boolean.need_light
          state: "on"
      action:
        - service: light.turn_on
          entity_id: light.0xa4c13887918ab25b

    - id: backlight_auto_off
      alias: backlight_auto_off
      description: Backlight - disable by no motion
      trigger:
        - platform: state
          entity_id: binary_sensor.0xa4c138638ca68c94_occupancy
          to: "off"
          for:
            hours: 0
            minutes: 1
            seconds: 0
      action:
        - service: light.turn_off
          entity_id: light.0xa4c13887918ab25b
