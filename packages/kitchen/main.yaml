kitchen:
  homeassistant:
    customize:
      light.kitchen:
        friendly_name: Kitchen Light
        icon: mdi:ceiling-light
      sensor.lywsd03mmc_temperature:
        friendly_name: Temperature
      sensor.lywsd03mmc_humidity:
        friendly_name: Humidity
      binary_sensor.kitchen_presence:
        friendly_name: Presence in Kitchen
      binary_sensor.0x54ef44100032140a_gas:
        friendly_name: Gas Leak
        device_class: gas
      binary_sensor.0x54ef44100048439c_smoke:
        friendly_name: Smoke Detector
        device_class: smoke
      binary_sensor.0x00158d0008e0331a_water_leak:
        friendly_name: Leak sensor - Sink
        device_class: moisture

  template:
    - binary_sensor:
        - name: kitchen_presence
          device_class: presence
          state: >
            {{ is_state('binary_sensor.0x54ef441000589d6f_presence', 'on') or
              states('sensor.0x54ef441000589d6f_presence_event') not in ['leave', 'unavailable', 'unknown']
            }}
        - name: kitchen_need_light
          state: >
            {{
              is_state('binary_sensor.kitchen_presence', 'on')
              and is_state('input_boolean.need_light', 'on')
            }}

  automation:
    - id: kitchen_presence_detected
      alias: kitchen_presence_detected
      description: Kitchen - presence detected
      trigger:
        - platform: state
          entity_id: binary_sensor.kitchen_need_light
          to: "on"
      condition:
        - condition: state
          entity_id: light.kitchen
          state: "off"

      action:
        - service: light.turn_on
          entity_id: light.kitchen

    - id: kitchen_presence_clear
      alias: kitchen_presence_clear
      description: Kitchen - presence clear
      trigger:
        - platform: state
          entity_id: binary_sensor.kitchen_need_light
          to: "off"
          for:
            hours: 0
            minutes: 0
            seconds: 30
        - platform: state
          entity_id: binary_sensor.kitchen_presence
          to: "off"
          for:
            hours: 0
            minutes: 0
            seconds: 30
      action:
        - service: light.turn_off
          entity_id: light.kitchen
